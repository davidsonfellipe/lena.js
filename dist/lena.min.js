/*! lena-js 2017-10-29 */
var LenaJS={};LenaJS.getImage=function(a){var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");return c.drawImage(a,0,0),c.getImageData(0,0,a.width,a.height)},LenaJS.printCanvas=function(a,b){a.width=b.width,a.height=b.height;var c=a.getContext("2d");c.putImageData(b,0,0)},LenaJS.filterImage=function(a,b,c){var d=[this.getImage(c)];return this.printCanvas(a,b.apply(null,d))},LenaJS.redrawCanvas=function(a,b){var c=a.getContext("2d");return c=[c.getImageData(0,0,a.width,a.height)],this.printCanvas(a,b.apply(null,c))},LenaJS.convolution=function(a,b){for(var c=Math.round(Math.sqrt(b.length)),d=Math.floor(c/2),e=a.data,f=a.width,g=a.height,h=document.createElement("canvas"),i=h.getContext("2d"),j=i.createImageData(f,g),k=0;g>k;k++)for(var l=0;f>l;l++){for(var m=4*(k*f+l),n=0,o=0,p=0,q=0;c>q;q++)for(var r=0;c>r;r++){var s=k+q-d,t=l+r-d;if(s>=0&&g>s&&t>=0&&f>t){var u=4*(s*f+t),v=b[q*c+r];n+=e[u]*v,o+=e[u+1]*v,p+=e[u+2]*v}}j.data[m]=n,j.data[m+1]=o,j.data[m+2]=p,j.data[m+3]=255}return j},LenaJS.gradient=function(a,b){for(var c=a.data,d=a.width,e=a.height,f=b.data,g=document.createElement("canvas"),h=g.getContext("2d"),i=h.createImageData(d,e),j=new Array(c.length).fill(0),k=0;e>k;k++)for(var l=0;d>l;l++){var m=4*(k*d+l);i.data[m]=Math.sqrt(Math.pow(c[m],2)+Math.pow(f[m],2)),i.data[m+1]=Math.sqrt(Math.pow(c[m+1],2)+Math.pow(f[m+1],2)),i.data[m+2]=Math.sqrt(Math.pow(c[m+2],2)+Math.pow(f[m+2],2)),i.data[m+3]=255,j[m]=Math.atan2(f[m],c[m]),j[m+1]=Math.atan2(f[m+1],c[m+1]),j[m+2]=Math.atan2(f[m+2],c[m+2]),j[m+3]=255}return result={magnitude:i,direction:j},result},LenaJS.histogram=function(a){"use strict";for(var b=this.getImage(a),c=new Array(257).join("0").split(""),d={r:c.map(Number),g:c.map(Number),b:c.map(Number)},e=0;e<b.data.length;e+=4)d.r[b.data[e]]++,d.g[b.data[e+1]]++,d.b[b.data[e+2]]++;return d},LenaJS.nonMaximumSuppression=function(a,b){for(var c=Math.round(Math.sqrt(25)),d=Math.floor(c/2),e=a.data,f=a.width,g=a.height,h=document.createElement("canvas"),i=h.getContext("2d"),j=i.createImageData(f,g),k=0;g>k;k++)for(var l=0;f>l;l++){for(var m=4*(k*f+l),n=e[m],o=e[m+1],p=e[m+2],q=(e[m+3],0);c>q;q++)for(var r=0;c>r;r++){var s=k+q-d,t=l+r-d;if(s>=0&&g>s&&t>=0&&f>t){var u=4*(s*f+t),v=Math.atan2(s-k,t-l);n=e[u]*Math.abs(Math.cos(b[m]-v))>n?0:n,o=e[u+1]*Math.abs(Math.cos(b[m+1]-v))>o?0:o,p=e[u+2]*Math.abs(Math.cos(b[m+2]-v))>p?0:p}}j.data[m]=2*n,j.data[m+1]=2*o,j.data[m+2]=2*p,j.data[m+3]=255}return j},LenaJS.bigGaussian=function(a,b){var c=159,d=[2/c,4/c,5/c,4/c,2/c,4/c,9/c,12/c,9/c,4/c,5/c,12/c,15/c,12/c,5/c,4/c,9/c,12/c,9/c,4/c,2/c,4/c,5/c,4/c,2/c];return LenaJS.convolution(a,d)},LenaJS.canny=function(a,b){a=LenaJS.bigGaussian(a);var c=LenaJS.sobelHorizontal(a),d=LenaJS.sobelVertical(a),e=LenaJS.gradient(c,d),f=LenaJS.laplacian(a);return a=LenaJS.nonMaximumSuppression(f,e.direction),LenaJS.thresholding(a,8)},LenaJS.gaussian=function(a,b){var c=16,d=[1/c,2/c,1/c,2/c,4/c,2/c,1/c,2/c,1/c];return LenaJS.convolution(a,d)},LenaJS.grayscale=function(a,b){for(var c=0;c<a.data.length;c+=4){var d=a.data[c],e=a.data[c+1],f=a.data[c+2];a.data[c]=a.data[c+1]=a.data[c+2]=.2126*d+.7152*e+.0722*f}return a},LenaJS.highpass=function(a,b){var c=[-1,-1,-1,-1,8,-1,-1,-1,-1];return LenaJS.convolution(a,c)},LenaJS.invert=function(a,b){for(var c=0;c<a.data.length;c+=4)a.data[c]=255-a.data[c],a.data[c+1]=255-a.data[c+1],a.data[c+2]=255-a.data[c+2];return a},LenaJS.laplacian=function(a,b){var c=[0,-1,0,-1,4,-1,0,-1,0];return LenaJS.convolution(a,c)},LenaJS.lowpass3=function(a,b){var c=1/9,d=[c,c,c,c,c,c,c,c,c];return LenaJS.convolution(a,d)},LenaJS.lowpass5=function(a,b){var c=.04,d=[c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c];return LenaJS.convolution(a,d)},LenaJS.mirror=function(a,b){for(var c=[],d=4*a.width,e=0;e<a.height;e++)for(var f=e*d,g=a.width/2,h=0;g>h;h++){var i=4*h,j=i+f,k=d-i-4+f;c[0]=a.data[j],c[1]=a.data[j+1],c[2]=a.data[j+2],c[3]=a.data[j+3],a.data[j]=a.data[k],a.data[j+1]=a.data[k+1],a.data[j+2]=a.data[k+2],a.data[j+3]=a.data[k+3],a.data[k]=c[0],a.data[k+1]=c[1],a.data[k+2]=c[2],a.data[k+3]=c[3]}return a},LenaJS.prewittHorizontal=function(a,b){var c=3,d=[1/c,1/c,1/c,0,0,0,-1/c,-1/c,-1/c];return LenaJS.convolution(a,d)},LenaJS.prewittVertical=function(a,b){var c=3,d=[-1/c,0,1/c,-1/c,0,1/c,-1/c,0,1/c];return LenaJS.convolution(a,d)},LenaJS.red=function(a,b){for(var c=a.data,d=0;d<c.length;d+=4)c[d]=c[d],c[d+1]=0,c[d+2]=0;return a},LenaJS.green=function(a,b){for(var c=a.data,d=0;d<c.length;d+=4)c[d]=0,c[d+2]=0;return a},LenaJS.blue=function(a,b){for(var c=a.data,d=0;d<c.length;d+=4)c[d]=0,c[d+1]=0;return a},LenaJS.roberts=function(a,b){var c=[0,0,0,1,-1,0,0,0,0];return LenaJS.convolution(a,c)},LenaJS.saturation=function(a,b){for(var c=2.9,d=.3086,e=.6084,f=.082,g=(1-c)*d+c,h=(1-c)*d,i=(1-c)*d,j=(1-c)*e,k=(1-c)*e+c,l=(1-c)*e,m=(1-c)*f,n=(1-c)*f,o=(1-c)*f+c,p=0;p<a.data.length;p+=4)a.data[p]=g*a.data[p]+j*a.data[p+1]+m*a.data[p+2],a.data[p+1]=h*a.data[p]+k*a.data[p+1]+n*a.data[p+2],a.data[p+2]=i*a.data[p]+l*a.data[p+1]+o*a.data[p+2];return a},LenaJS.sepia=function(a,b){for(var c=0;c<a.data.length;c+=4){var d=a.data[c],e=a.data[c+1],f=a.data[c+2];a.data[c]=a.data[c+1]=a.data[c+2]=.3*d+.59*e+.11*f,a.data[c]+=40,a.data[c+1]+=20,a.data[c+2]-=20}return a},LenaJS.sharpen=function(a,b){var c=[0,-.2,0,-.2,1.8,-.2,0,-.2,0];return LenaJS.convolution(a,c)},LenaJS.sobelHorizontal=function(a,b){var c=4,d=[1/c,2/c,1/c,0,0,0,-1/c,-2/c,-1/c],a=LenaJS.convolution(a,d);return a},LenaJS.sobelVertical=function(a,b){var c=4,d=[1/c,0,-1/c,2/c,0,-2/c,1/c,0,-1/c],a=LenaJS.convolution(a,d);return a},LenaJS.thresholding=function(a,b){for(var c=0;c<a.data.length;c+=4){var d=a.data[c],e=a.data[c+1],f=a.data[c+2],g=.2126*d+.7152*e+.0722*f;thr=b||128,a.data[c]=a.data[c+1]=a.data[c+2]=g>thr?255:0}return a};